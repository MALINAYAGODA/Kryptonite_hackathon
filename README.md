# Kryptonite ML Challenge - команда NEURAL DEFENDERS
## Задача
Задача заключалась в создании модели распознавания лиц, устойчивой к DeepFake-атакам. Участникам предстояло разработать систему, которая должна уметь:

- Сравнивать реальные фотографии одного и того же человека
- Различать снимки разных людей  
- Распознавать фальшивые изображения, созданные с помощью DeepFake-технологий, без использования модулей защиты от спуфинга

Поддельные изображения и видео, созданные с помощью технологии DeepFake, представляют серьезную угрозу для цифровой безопасности. Они могут быть настолько реалистичными, что их сложно отличить от настоящих невооруженным глазом.


## Data
Был предоставлен датасет с парами изображений лиц, включающий:
- Реальные фотографии одних и тех же людей
- Фотографии разных людей
- Синтетические изображения, созданные с помощью DeepFake-технологий

Основная проблема заключалась в высоком качестве синтетических изображений, которые визуально практически неотличимы от реальных фотографий.

## ML Технологии
Весь код был написан на языке Python.
1) Предобработка и выравнивание изображений лиц с помощью CVLFaceAlignmentModel
2) Использование архитектуры IR-101 (Improved ResNet) для извлечения эмбеддингов лиц
3) Реализация адаптивной функции потерь (Dynamic Margin Loss) для улучшения разделимости классов
4) Применение косинусного сходства для сравнения эмбеддингов лиц
5) Использование смешанной точности (Mixed Precision) для ускорения обучения
6) Система валидации с вычислением EER (Equal Error Rate) и детализированной статистикой ошибок
7) Автоматическое сохранение лучших моделей с системой лидерборда

## Архитектурное решение
Я предоставил комплексное решение для обучения и предобработки данных

**Система обучения (train.py):** Загрузка предобученной модели IR-101 -> Обучение с адаптивной функцией потерь -> Валидация на тестовых данных -> Сохранение лучших чекпоинтов -> Логирование метрик в WandB. **Результат: высокая точность распознавания и устойчивость к DeepFake-атакам**

**Система предобработки (align.py):** Загрузка исходных изображений -> Выравнивание лиц с помощью CVLFaceAlignmentModel -> Нормализация и сохранение обработанных изображений -> Пакетная обработка больших датасетов. **Данная система обеспечивает единообразное качество входных данных для модели.**

**Ключевые особенности:**
- Адаптивный маржин в функции потерь для лучшего разделения классов
- Система отслеживания производительности с JSON-логированием
- Автоматическое управление чекпоинтами с сохранением топ-5 моделей
- Детализированная статистика ошибок по типам (реальные пары, разные люди, синтетические изображения)

## Технические детали
- **Архитектура модели:** Improved ResNet-101
- **Функция потерь:** Dynamic Margin Loss с адаптивным маржином
- **Оптимизатор:** AdamW с weight decay
- **Планировщик:** ReduceLROnPlateau для адаптивного изменения learning rate
- **Метрики:** Accuracy, EER (Equal Error Rate), детализированная статистика ошибок
- **Выравнивание лиц:** CVLFaceAlignmentModel для предобработки

## Структура проекта
```
├── train.py                    # Основной скрипт обучения модели
├── align.py                    # Система предобработки и выравнивания лиц
├── training_logs/              # Логи обучения и чекпоинты
│   ├── checkpoints/           # Сохраненные модели
│   ├── pretrained/           # Предобученные модели
│   └── performance_history.json # История производительности
├── datasets/                   # Датасеты
    ├── training/              # Тренировочные данные
    ├── validation/            # Валидационные данные
    ├── raw_images/           # Исходные изображения
    └── processed_images/     # Обработанные изображения
```

## Результаты
Моя модель показала высокую эффективность в задаче распознавания лиц и детекции DeepFake-изображений.